namespace = regula_initialize_event

regula_initialize_event.0001 = {
	type = character_event
	title = regula_initialize_event.0001.t
	desc = regula_initialize_event.0001.desc

	theme = realm

	right_portrait = {
		character = root
		animation = scheme
	}

	immediate = {
		play_music_cue = "mx_cue_sacredrite"
		remove_character_flag = regula_decision_taken
	}

	option = {
		name = regula_initialize_event.0001.a
		show_as_tooltip = {
			add_trait = magister_2
			add_realm_law = regula_magister_gender_law
		}

		set_global_variable = {
			name = regula_initialized
			value = yes
		}
		trigger_event = {
			on_action = regula_initialize_start_response
			}
		}	# Become a magister
	option = {
		name = regula_initialize_event.0001.b	# Back out.
	}
}

regula_initialize_event.0002 = {
	type = character_event
	title = regula_initialize_event.0002.t
	desc = regula_initialize_event.0002.desc

	theme = realm

	left_portrait = {
		character = root
		animation = personality_bold
	}

	immediate = {
		play_music_cue = "mx_cue_epic_sacral_moment"
		add_piety_level = -5  # Because set_piety_level doesn't exist.
		hidden_effect = { add_piety_level = 1 }
		add_trait = magister_2
	}

	option = {
		name = regula_initialize_event.0002.a
		flavor = regula_initialize_event.0002.a.tt
		root = {
			set_character_faith = faith:regula_mediterranean
		}
		root.capital_province.county = {
			set_county_faith = root.faith 
		}
		add_realm_law = regula_magister_gender_law
		hidden_effect = {
			add_prestige = 500
			set_global_variable = {  # Sets up a magister scope.
				name = magister_character
				value = root
			}
		}
		every_vassal = {
			limit = {
				highest_held_title_tier >= tier_county
			}
			add_realm_law = regula_vassal_succession_law
		}
		trigger_event = {
			on_action = regula_initialize_complete_response
		}
	}
	option = {
		name = regula_initialize_event.0002.b
		flavor = regula_initialize_event.0002.b.tt
		root = {
			set_character_faith = faith:regula_european
		}

		root.capital_province.county = {
			set_county_faith = root.faith 
		}
		add_realm_law = regula_magister_gender_law
		hidden_effect = {
			add_prestige = 500
			set_global_variable = {  # Sets up a magister scope.
				name = magister_character
				value = root
			}
		}
		every_vassal = {
			limit = {
				highest_held_title_tier >= tier_county
			}
			add_realm_law = regula_vassal_succession_law
		}
		trigger_event = {
			on_action = regula_initialize_complete_response
		}
	}
}

# Once more into the breach.
regula_initialize_event.0010 = {
	type = character_event
	title = regula_initialize_event.0010.t
	desc = regula_initialize_event.0010.desc

	theme = realm

	right_portrait = {
		character = root
		animation = stress
	}

	trigger = {
		is_ai = no
		is_male = yes
		age >= 16
		has_global_variable = regula_initialized
		NOT = { has_global_variable = regula_burned }
		NOT = { 
			has_trait = magister_trait_group 
			has_character_flag = regula_destroyed_character
		}
	}

	immediate = {
		play_music_cue = "mx_cue_sacredrite"
		remove_character_flag = regula_decision_taken
	}

	option = {
		name = regula_initialize_event.0010.a
		add_piety_level = -5  # Because set_piety_level doesn't exist.
		hidden_effect = { 
			add_piety_level = 1 
			
		}
		add_trait = magister_2
		set_character_faith = global_var:magister_character.faith

		hidden_effect = {
			set_global_variable = {  # Now that the faith is set update the magister scope.
				name = magister_character
				value = root
			}
		}
		if = { 
			limit = { NOT = { has_realm_law = regula_magister_gender_law } }
			add_realm_law = regula_magister_gender_law
		}
		every_vassal = {
			limit = {
				highest_held_title_tier >= tier_county
			}
			if = {
				limit = { NOT = { has_realm_law = regula_vassal_succession_law } }
				add_realm_law = regula_vassal_succession_law
			}
		}
		trigger_event = {
			on_action = regula_initialize_complete_response
		}
	}

	option = {
		name = regula_initialize_event.0010.b	# Disable the Magister traits.
		custom_tooltip = regula_initialize_event.0010.b.tt
		hidden_effect = {

			add_character_flag = {
				flag = regula_destroyed_character
			}
			set_global_variable = {  # Sets up a magister scope.
				name = regula_burned
				value = yes
			}
			every_in_global_list = {
				list = regula_undying_character_list
				death = {
					death_reason = death_vanished
				}
			}
			clear_global_variable_list = regula_undying_character_list
		}
	}
}

# Re-initializes the mod, for those that previously destroyed the book.
regula_initialize_event.0011 = {
	type = character_event
	title = regula_initialize_event.0011.t
	desc = regula_initialize_event.0011.desc

	theme = realm

	right_portrait = {
		character = root
		animation = personality_rational
	}

	immediate = {
		play_music_cue = "mx_cue_sacredrite"
		remove_character_flag = regula_decision_taken
	}

	option = { # Become a Magister.
		name = regula_initialize_event.0011.a
		add_piety_level = -5  # Because set_piety_level doesn't exist.
		hidden_effect = { 
			add_piety_level = 1 
		}
	
		add_trait = magister_2 
		set_character_faith = global_var:magister_character.faith

		hidden_effect = {
			set_global_variable = {  # Now that the faith is set update the magister scope.
				name = magister_character
				value = root
			}
		}
		remove_global_variable = regula_burned
		if = { 
			limit = { NOT = { has_realm_law = regula_magister_gender_law } }
			add_realm_law = regula_magister_gender_law
		}
		every_vassal = {
			limit = {
				highest_held_title_tier >= tier_county
			}
			if = {
				limit = { NOT = { has_realm_law = regula_vassal_succession_law } }
				add_realm_law = regula_vassal_succession_law
			}
		}
		trigger_event = {
			on_action = regula_initialize_complete_response
		}
	}

	option = { # Back out.
		name = regula_initialize_event.0011.b	
		custom_tooltip = regula_initialize_event.0011.b.tt
		hidden_effect = {
			add_character_flag = {
				flag = regula_destroyed_character
			}
			every_in_global_list = {
				list = regula_undying_character_list
				death = {
					death_reason = death_vanished
				}
			}
		}
	}
}
# Remove magister traits from characters that no longer follow the religion.
regula_initialize_event.0012 = {
	type = character_event
	hidden = yes

	trigger = {
		has_trait = magister_trait_group
		faith = {
			NOT = { has_doctrine_parameter = magister_tenet_traits }
		}		
	}

	immediate = {
		if = {
			limit = {
				has_trait = magister_2
			}
			remove_trait = magister_2
			add_trait = magister_1
		}
		if = {
			limit = {
				has_trait = magister_3
			}
			remove_trait = magister_3
			add_trait = magister_1
		}
		if = {
			limit = {
				has_trait = magister_4
			}
			remove_trait = magister_4
			add_trait = magister_1
		}
		if = {
			limit = {
				has_trait = magister_5
			}
			remove_trait = magister_5
			add_trait = magister_1
		}
		if = {
			limit = {
				has_trait = magister_6
			}
			remove_trait = magister_6
			add_trait = magister_1
		}
	}
}

# Settings Menu
regula_initialize_event.1000 = {
	type = character_event
	title = regula_initialize_event.1000.t
	desc = regula_initialize_event.1000.desc

    theme = regula_theme

    override_background = {
		event_background = throne_room
	}

	# option = { # Tweak Suggestions Tab
	# 	name = regula_initialize_event.1000.a

	# 	trigger_event = {
	# 		id = regula_initialize_event.1001
	# 	}
	# }
	
	option = { # Religion
		name = regula_initialize_event.1000.b

		trigger = {
			religion = {
				is_in_family = rf_regula
			}
		}

		trigger_event = {
			id = regula_initialize_event.1010
		}
	}

	# option = { # Birth Control
	# 	name = regula_initialize_event.1000.c

	# 	trigger_event = {
	# 		id = regula_childhood_event.0020
	# 	}
	# }


	option = { # Wards 
		name = regula_initialize_event.1000.d

		trigger_event = {
			id = regula_childhood_event.0010
		}
	}

	option = { # Exit
		name = regula_initialize_event.1000.e
	}
}


# Tweak Suggestions Tab
regula_initialize_event.1001 = {
	type = character_event
	title = regula_initialize_event.1001.t
	desc = regula_initialize_event.1001.desc
    theme = regula_theme

    override_background = {
		event_background = throne_room
	}

	option = {
		name = regula_initialize_event.1001.a

	
		trigger_event = {
			id = regula_initialize_event.1002
		}
	}

	
	option = {
		name = regula_initialize_event.1001.menu
		trigger_event = {
			id = regula_initialize_event.1000
		}
	}

	option = {
		name = regula_initialize_event.1001.exit
	}
}

# Suggestions Tab - Dominate Mulsa Suggestion
regula_initialize_event.1002 = {
	type = character_event
	title = regula_initialize_event.1002.t
	desc = regula_initialize_event.1002.desc
    theme = regula_theme

    override_background = {
		event_background = throne_room
	}

	immediate = {
	}

	# Dominate all
	option = {
		name = regula_initialize_event.1002.a
		flavor = regula_initialize_event.1002.a.tt

		set_global_variable = {
			name = action_regula_make_paelex_value
            value = flag:all
		}
	}

	# Direct Vassals
	option = {
		name = regula_initialize_event.1002.b

		set_global_variable = {
			name = action_regula_make_paelex_value
            value = flag:direct
		}
	}

	# Hide the suggestion	
	option = {
		name = regula_initialize_event.1002.c

		set_global_variable = {
			name = action_regula_make_paelex_value
            value = flag:none
		}
	}	

	option = {
		name = regula_initialize_event.1001.menu
		trigger_event = {
			id = regula_initialize_event.1000
		}
	}

	option = {
		name = regula_initialize_event.1001.exit
	}
}


# Swap religion types.
regula_initialize_event.1010 = {
	type = character_event
	title = regula_initialize_event.1010.t
	desc = regula_initialize_event.1010.desc
    theme = regula_theme

    override_background = {
		event_background = throne_room
	}

	option = {
		name = regula_initialize_event.1010.a

		trigger = {
			NOT = {
				faith = faith:regula_mediterranean
			}
		}

		faith = {
			save_scope_as = old_faith
		}
		if = {
			limit = {
				exists = faith.religious_head
				root = faith.religious_head
			}
			faith = {
				remove_religious_head_title = yes
			}
			set_character_faith = faith:regula_mediterranean
			hidden_effect = {
				regula_faith_swap = yes
			}
		}
		else = {
			set_character_faith = faith:regula_mediterranean
			hidden_effect = {
				regula_faith_swap = yes
			}
		}
		trigger_event = {
			id = regula_initialize_event.1000
		}
	}

	option = {
		name = regula_initialize_event.1010.b

		trigger = {
			NOT = {
				faith = faith:regula_european
			}
		}

		religion = {
			save_scope_as = old_faith
		}
		if = {
			limit = {
				exists = faith.religious_head
				root = faith.religious_head
			}
			faith = {
				remove_religious_head_title = yes
			}
			set_character_faith = faith:regula_european
			hidden_effect = {
				regula_faith_swap = yes
			}
		}
		else = {
			set_character_faith = faith:regula_european
			hidden_effect = {
				regula_faith_swap = yes
			}
		}
		hidden_effect = {		

		}

		trigger_event = {
			id = regula_initialize_event.1000
		}
	}

	option = {
		name = regula_initialize_event.1010.menu
		trigger_event = {
			id = regula_initialize_event.1000
		}
	}

	option = {
		name = regula_initialize_event.1010.exit
	}
}