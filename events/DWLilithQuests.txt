namespace = DWLilithQuests

###MISSIONS###
##DW Mission Tombola
character_event = {
	id = DWLilithQuests.1
	hide_window = yes

	is_triggered_only = yes
	is_in_society = yes
	only_capable = yes

	trigger = {
		society_member_of = dw_the_chosen_of_lilith
		has_any_quest = no
		NOT = { has_character_modifier = quest_cooldown_timer }
		NOT = { is_society_grandmaster = yes }
		NOT = { is_inaccessible_trigger = yes }
	}

	immediate = {
		random_society_member = {
			limit = {
				is_society_grandmaster = yes
				same_society_as = ROOT
			}
			save_event_target_as = grand_enchanter
		}

		random_list = { 
			20 = {
				modifier = { 
					factor = 0 
					is_playable = no 
				}
				modifier = {
					factor = 0
					NOT = {
						any_character = {
							NOT = { trait = dwf_ghost }
					    	is_offmap_ruler = no
					        is_priest = yes
							is_adult = yes
					        ai = yes
					        NOT = { character = ROOT }
					        is_within_diplo_range = ROOT
					        is_inaccessible_trigger = no
					        religion = ROOT
					        prisoner = no
							NOR = { 
								is_lover = ROOT 
								is_consort = ROOT
								is_close_relative = ROOT
							}
					        NOR = { 
								trait = incapable
								trait = chaste
								trait = celibate
								trait = eunuch
							}
					        NOT = { same_society_as = ROOT }
						}
					}
				}
				event_target:grand_enchanter = {
					character_event = { id = DWLilithQuests.4 } # Seduce a priest
				}
			}
			20 = {
				modifier = { 
					factor = 0 
					is_playable = no 
				}
				modifier = {
					factor = 0
					NOT = {
						any_character = {
							NOT = { trait = dwf_ghost }
					    	is_offmap_ruler = no
					        is_adult = yes
					        ai = yes
					        NOT = { character = ROOT }
					        is_within_diplo_range = ROOT
					        is_inaccessible_trigger = no
					        trait = virgin
					        prisoner = no
							NOR = { 
								is_lover = ROOT 
								is_consort = ROOT
								is_close_relative = ROOT
							}
					        NOR = { 
								trait = incapable
								trait = chaste
								trait = celibate
								trait = eunuch
							}
					        NOT = { same_society_as = ROOT }
						}
					}
				}
				event_target:grand_enchanter = {
					character_event = { id = DWLilithQuests.2 } # Seduce a virgin 
				}
			}
			20 = {
				modifier = { 
					factor = 0 
					is_playable = no 
				}
				modifier = {
					factor = 0
					NOT = {
						any_character = {
							NOT = { trait = dwf_ghost }
					    	is_offmap_ruler = no
					        is_adult = yes
					        ai = yes
					        NOT = { character = ROOT }
					        is_within_diplo_range = ROOT
					        is_inaccessible_trigger = no
					        trait = virgin
					        prisoner = no
							NOR = { 
								is_lover = ROOT 
								is_consort = ROOT
								is_close_relative = ROOT
							}
					        NOR = { 
								trait = incapable
								trait = chaste
								trait = celibate
								trait = eunuch
							}
					        NOT = { same_society_as = ROOT }
						}
					}
				}				
				event_target:grand_enchanter = {
					character_event = { id = DWLilithQuests.6 } # Seduce a ruler
				}
			}
			20 = {
				modifier = { 
					factor = 0 
					is_playable = no 
				}
				modifier = {
					factor = 0
					NOT = {
						any_character = {
							NOT = { trait = dwf_ghost }
					    	is_offmap_ruler = no
					        is_adult = yes
					        ai = yes
					        NOT = { character = ROOT }
					        is_within_diplo_range = ROOT
					        is_inaccessible_trigger = no
					        is_married = yes
							spouse = {
								is_offmap_ruler = no
								ai = yes
								NOT = {character = ROOT}
								is_ruler = yes
							}
					        prisoner = no
							NOR = { 
								is_lover = ROOT 
								is_consort = ROOT
								is_close_relative = ROOT
							}
					        NOR = { 
								trait = incapable
								trait = chaste
								trait = celibate
								trait = eunuch
							}
					        NOT = { same_society_as = ROOT }
						}
					}
				}				
				event_target:grand_enchanter = {
					character_event = { id = DWLilithQuests.10 } # Seduce a ruler's spouse
				}
			}
			
			75 = { # AI bypasses missions at times
				modifier = {
					factor = 0
					ai = no
				}
				random_list = {
					70 = {
						modifier = {
							factor = 0.9
							society_influence >= 30
						}
						modifier = {
							factor = 0.9
							society_influence >= 40
						}
						modifier = {
							factor = 0.8
							society_influence >= 50
						}
						modifier = {
							factor = 0.7
							society_influence >= 70
						}
						modifier = {
							factor = 0.6
							society_influence >= 80
						}
						modifier = {
							factor = 0.5
							society_influence >= 90
						}
						add_mission_succeed_influence_effect = yes
					}
					30 = {
						add_mission_fail_influence_effect = yes
					}
				}
			}
			200 = {
				modifier = {
					factor = 0
					ai = no
				}
				#Do nothing for AI
			}
		}
	}
}

###Desecrate temple###

#MISSION: Seduce a virgin
#Ping event for the mission Seduce a Virgin
character_event = {
	id = DWLilithQuests.2
	hide_window = yes

	is_triggered_only = yes

	immediate = { FROM = { society_quest_event = { id = DWLilithQuests.3 days = 7 random = 7 } } }
}

#Assign event
society_quest_event = {
	id = DWLilithQuests.3
	desc = DWLilithQuests3

	is_triggered_only = yes

	immediate = {
		any_character = {
			limit = {
				is_offmap_ruler = no
				is_adult = yes
				ai = yes
				NOT = { character = ROOT }
				is_within_diplo_range = ROOT
				is_inaccessible_trigger = no
				trait = virgin
				prisoner = no
				NOR = { 
					is_lover = ROOT 
					is_consort = ROOT
					is_close_relative = ROOT
				}
				NOR = { 
					trait = incapable
					trait = chaste
					trait = celibate
					trait = eunuch
				}
				NOT = { same_society_as = ROOT }
					NOR = {
						has_opinion_modifier = { who = ROOT modifier = opinion_seduced_refused }
						has_character_modifier = dismissed_proposal
						has_opinion_modifier = { who = ROOT modifier = dw_opinion_recently_seduced }
					}
			}
			save_event_target_as = dw_seduce_virgin_target
		}	
	}

	quest_target = event_target:dw_seduce_virgin_target

	option = {
		name = ACCEPT
		event_target:dw_seduce_virgin_target = {
			set_quest_target = {
				id = quest_lilith_seduce_virgin
				holder = ROOT
			}
		}
	}
	option  = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }

		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			days = 1000
		}

		ai_chance = { factor = 0 }
	}
}


#MISSION: Seduce a priest
#Ping event for mission Seduce a Priest
character_event = {
	id = DWLilithQuests.4
	hide_window = yes

	is_triggered_only = yes

	immediate = { 
		FROM = { society_quest_event = { id = DWLilithQuests.5 days = 7 random = 7 } }
	}
}

#MISSION: 
#We want you to seduce this priest!
society_quest_event = {
	id = DWLilithQuests.5
	desc = DWLilithQuests5
	quest_target = event_target:dw_seduce_priest_target

	is_triggered_only = yes

	immediate = {
		random_character = {
		    limit = {
		    	is_offmap_ruler = no
		        is_priest = yes
				is_adult = yes
		        ai = yes
		        NOT = { character = ROOT }
		        is_within_diplo_range = ROOT
		        is_inaccessible_trigger = no
		        religion = ROOT
		        prisoner = no
		        NOT = { trait = incapable }
		        NOT = { same_society_as = ROOT }
				NOR = {
					has_opinion_modifier = { who = ROOT modifier = opinion_seduced_refused }
					has_character_modifier = dismissed_proposal
					has_opinion_modifier = { who = ROOT modifier = dw_opinion_recently_seduced }
				}
				NOR = { 
					trait = incapable
					trait = chaste
					trait = celibate
					trait = eunuch
				}
		    }
		    save_event_target_as = dw_seduce_priest_target
		}
		if = {
		    limit = { society_rank >= 2 }
		    random_character = {
		        limit = {
		        	is_offmap_ruler = no
		            is_ruler = yes
					is_adult = yes
		            ai = yes
		            NOT = { character = ROOT }
		            is_within_diplo_range = ROOT
		            is_inaccessible_trigger = no
		            religion = ROOT
		            prisoner = no
		            NOT = { trait = incapable }
		            higher_tier_than = BARON
		            lower_tier_than = KING
		            is_priest = yes
		            NOT = { same_society_as = ROOT }
					NOR = {
						has_opinion_modifier = { who = ROOT modifier = opinion_seduced_refused }
						has_character_modifier = dismissed_proposal
						has_opinion_modifier = { who = ROOT modifier = dw_opinion_recently_seduced }
					}
					NOR = { 
						trait = incapable
						trait = chaste
						trait = celibate
						trait = eunuch
					}
		        }
		        save_event_target_as = dw_seduce_priest_target
		    }
		}      
		if = {
		    limit = { society_rank >= 3 }
		    random_character = {
		        limit = {
		        	is_offmap_ruler = no
		            is_ruler = yes
					is_adult = yes
		            ai = yes
		            NOT = { character = ROOT }
		            is_within_diplo_range = ROOT
		            is_inaccessible_trigger = no
		            religion = ROOT
		            prisoner = no
		            NOT = { trait = incapable }
		            higher_tier_than = BARON
		            is_priest = yes
		            NOT = { same_society_as = ROOT }
					NOR = {
						has_opinion_modifier = { who = ROOT modifier = opinion_seduced_refused }
						has_character_modifier = dismissed_proposal
						has_opinion_modifier = { who = ROOT modifier = dw_opinion_recently_seduced }
					}
					NOR = { 
						trait = incapable
						trait = chaste
						trait = celibate
						trait = eunuch
					}
		        }
		        save_event_target_as = dw_seduce_priest_target
		    }
		}
	}

	option = { #accept
		name = ACCEPT
		event_target:dw_seduce_priest_target = {
			set_character_flag = appear_in_option
			clr_character_flag = appear_in_option
		}
		event_target:dw_seduce_priest_target = {
			set_quest_target = {
				id = quest_lilith_seduce_priest
				holder = ROOT
			}
		}
	}
	option = { #nah thx
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }

		hidden_effect = {
			add_character_modifier = {
				name = quest_cooldown_timer
				hidden = yes
				days = 1000
			}
		}
		ai_chance = { factor = 0 }
	}
}
#MISSION: Seduce a ruler
#Ping event for mission Seduce a Ruler
character_event = {
	id = DWLilithQuests.6
	hide_window = yes

	is_triggered_only = yes

	immediate = { 
		FROM = { society_quest_event = { id = DWLilithQuests.7 days = 7 random = 7 } }
	}
}

#MISSION: 
#We want you to seduce this ruler!
society_quest_event = {
	id = DWLilithQuests.7
	desc = DWLilithQuests7
	quest_target = event_target:dw_seduce_ruler_target

	is_triggered_only = yes

	immediate = {
		random_character = {
		    limit = {
		    	is_offmap_ruler = no
		        is_ruler = yes
				is_adult = yes
		        ai = yes
		        NOT = { character = ROOT }
		        is_within_diplo_range = ROOT
				NOT = { same_realm = ROOT }
		        is_inaccessible_trigger = no
		        prisoner = no
		        NOT = { trait = incapable }
		        NOT = { same_society_as = ROOT }
				NOR = {
					has_opinion_modifier = { who = ROOT modifier = opinion_seduced_refused }
					has_character_modifier = dismissed_proposal
					has_opinion_modifier = { who = ROOT modifier = dw_opinion_recently_seduced }
				}
				NOR = { 
					trait = incapable
					trait = chaste
					trait = celibate
					trait = eunuch
				}
		    }
		    save_event_target_as = dw_seduce_ruler_target
		}
		if = {
		    limit = { society_rank >= 2 }
		    random_character = {
		        limit = {
		        	is_offmap_ruler = no
		            is_ruler = yes
					is_adult = yes
		            ai = yes
		            NOT = { character = ROOT }
		            is_within_diplo_range = ROOT
		            is_inaccessible_trigger = no
		            prisoner = no
		            NOT = { trait = incapable }
		            higher_tier_than = BARON
		            lower_tier_than = KING
					NOT = { same_realm = ROOT }
		            NOT = { same_society_as = ROOT }
					NOR = {
						has_opinion_modifier = { who = ROOT modifier = opinion_seduced_refused }
						has_character_modifier = dismissed_proposal
						has_opinion_modifier = { who = ROOT modifier = dw_opinion_recently_seduced }
					}
					NOR = { 
						trait = incapable
						trait = chaste
						trait = celibate
						trait = eunuch
					}
		        }
		        save_event_target_as = dw_seduce_ruler_target
		    }
		}      
		if = {
		    limit = { society_rank >= 3 }
		    random_character = {
		        limit = {
		        	is_offmap_ruler = no
		            is_ruler = yes
					is_adult = yes
		            ai = yes
		            NOT = { character = ROOT }
		            is_within_diplo_range = ROOT
		            is_inaccessible_trigger = no
		            prisoner = no
		            NOT = { trait = incapable }
		            higher_tier_than = BARON
					NOT = { same_realm = ROOT }
		            NOT = { same_society_as = ROOT }
					NOR = {
						has_opinion_modifier = { who = ROOT modifier = opinion_seduced_refused }
						has_character_modifier = dismissed_proposal
						has_opinion_modifier = { who = ROOT modifier = dw_opinion_recently_seduced }
					}
					NOR = { 
						trait = incapable
						trait = chaste
						trait = celibate
						trait = eunuch
					}
				}
		        save_event_target_as = dw_seduce_ruler_target
		    }
		}
	}

	option = { #accept
		name = ACCEPT
		event_target:dw_seduce_ruler_target = {
			set_character_flag = appear_in_option
			clr_character_flag = appear_in_option
		}
		event_target:dw_seduce_ruler_target = {
			set_quest_target = {
				id = quest_lilith_seduce_ruler
				holder = ROOT
			}
		}
	}
	option = { #nah thx
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }

		hidden_effect = {
			add_character_modifier = {
				name = quest_cooldown_timer
				hidden = yes
				days = 1000
			}
		}
		ai_chance = { factor = 0 }
	}
}




narrative_event = { # Human/Other to Alu-Fiend/Cambion
	id = DWLilithQuests.8
	title = DWLilithQuests8T
	desc = DWLilithQuests8
	picture = lilith_infuse_demon_blood_half
	is_triggered_only = yes
	
	option = {
		name = DWLilithQuests8TTA
		trigger = {
			NOT = { is_female = yes }
		}
		add_trait = cambion
	}
	option = {
		name = DWLilithQuests8TTA
		trigger = {
			is_female = yes
		}
		add_trait = alu_fiend
	}
}
narrative_event = { # Alu-Fiend/Cambion to Succubus/Incubus
	id = DWLilithQuests.9
	picture = a_placeholder
	title = DWLilithQuests9T
	desc = {
		trigger = {
			trait = cambion
		}
		text = DWLilithQuests9Male
		picture = lilith_infuse_demon_blood_full_male
	}
	desc = {
		trigger = {
			trait = alu_fiend
			trait = futa
		}
		text = DWLilithQuests9Futa
		picture = lilith_infuse_demon_blood_full_futa
	}
	desc = {
		trigger = {
			trait = alu_fiend
			NOT = { trait = futa }
		}
		text = DWLilithQuests9Female
		picture = lilith_infuse_demon_blood_full_female
	}
	
	is_triggered_only = yes
	
	option = {
		name = DWLilithQuests9TTA
		trigger = {
			NOT = { is_female = yes }
		}
		remove_trait = cambion
		add_trait = incubus
		hidden_tooltip = {
			if = {
				limit = {
					NOR = {
						trait = tentacle
						trait = orc
						trait = elf
						trait = neko
						trait = kitsune
						trait = werewolf
						trait = fairy
						trait = dwse_lizard
						trait = dragon_adult
						trait = houseirae_drow
						trait = houseirae_halfelf
					}
				}
				add_random_demon_portrait = yes
			}
		}
	}
	option = {
		name = DWLilithQuests9TTB
		trigger = {
			is_female = yes
		}
		remove_trait = alu_fiend
		add_trait = lilith
		hidden_tooltip = {
			if = {
				limit = {
					NOR = {
						trait = tentacle
						trait = orc
						trait = elf
						trait = neko
						trait = kitsune
						trait = werewolf
						trait = fairy
						trait = dwse_lizard
						trait = dragon_adult
						trait = houseirae_drow
						trait = houseirae_halfelf
					}
				}
				add_random_demon_portrait = yes
			}
		}
	}
}


#MISSION: 
#We want you to seduce this ruler's spouse!
society_quest_event = {
	id = DWLilithQuests.10
	desc = DWLilithQuests10
	quest_target = event_target:dw_seduce_spouse_target

	is_triggered_only = yes

	immediate = {
		random_character = {
		    limit = {
		    	is_offmap_ruler = no
				is_married = yes
				spouse = {
					is_offmap_ruler = no
					ai = yes
					NOT = {character = ROOT}
					is_ruler = yes
				        lower_tier_than = KING
					NOT = { same_realm = ROOT }

					}
			is_adult = yes
		        ai = yes
		        NOT = { character = ROOT }
		        is_within_diplo_range = ROOT
				NOT = { same_realm = ROOT }
		        is_inaccessible_trigger = no
		        prisoner = no
		        NOT = { trait = incapable }
		        NOT = { same_society_as = ROOT }
				NOR = {
					has_opinion_modifier = { who = ROOT modifier = opinion_seduced_refused }
					has_character_modifier = dismissed_proposal
					has_opinion_modifier = { who = ROOT modifier = dw_opinion_recently_seduced }
				}
				NOR = { 
					trait = incapable
					trait = chaste
					trait = celibate
					trait = eunuch
				}
		    }
		    save_event_target_as = dw_seduce_spouse_target
		}
		if = {
		    limit = { society_rank >= 2 }
		    random_character = {
		        limit = {
		        	is_offmap_ruler = no
				is_married = yes
				spouse = {
					is_offmap_ruler = no
					ai = yes
					NOT = {character = ROOT}
					is_ruler = yes
		 		        higher_tier_than = BARON
				        lower_tier_than = KING
					NOT = { same_realm = ROOT }

					}
				is_adult = yes
		            ai = yes
		            NOT = { character = ROOT }
		            is_within_diplo_range = ROOT
		            is_inaccessible_trigger = no
		            prisoner = no
		            NOT = { trait = incapable }
		            NOT = { same_society_as = ROOT }
					NOR = {
						has_opinion_modifier = { who = ROOT modifier = opinion_seduced_refused }
						has_character_modifier = dismissed_proposal
						has_opinion_modifier = { who = ROOT modifier = dw_opinion_recently_seduced }
					}
					NOR = { 
						trait = incapable
						trait = chaste
						trait = celibate
						trait = eunuch
					}
		        }
		        save_event_target_as = dw_seduce_spouse_target
		    }
		}      
		if = {
		    limit = { society_rank >= 3 }
		    random_character = {
		        limit = {
		        	is_offmap_ruler = no
				is_married = yes
				spouse = {
					is_offmap_ruler = no
					ai = yes
					NOT = {character = ROOT}
					is_ruler = yes
		 		        higher_tier_than = BARON
					NOT = { same_realm = ROOT }

					}
					is_adult = yes
		            ai = yes
		            NOT = { character = ROOT }
		            is_within_diplo_range = ROOT
		            is_inaccessible_trigger = no
		            prisoner = no
		            NOT = { trait = incapable }
					NOT = { same_realm = ROOT }
		            NOT = { same_society_as = ROOT }
					NOR = {
						has_opinion_modifier = { who = ROOT modifier = opinion_seduced_refused }
						has_character_modifier = dismissed_proposal
						has_opinion_modifier = { who = ROOT modifier = dw_opinion_recently_seduced }
					}
					NOR = { 
						trait = incapable
						trait = chaste
						trait = celibate
						trait = eunuch
					}
				}
		        save_event_target_as = dw_seduce_spouse_target
		    }
		}
	}

	option = { #accept
		name = ACCEPT
		event_target:dw_seduce_spouse_target = {
			set_character_flag = appear_in_option
			clr_character_flag = appear_in_option
		}
		event_target:dw_seduce_spouse_target = {
			set_quest_target = {
				id = quest_lilith_seduce_spouse
				holder = ROOT
			}
		}
	}
	option = { #nah thx
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }

		hidden_effect = {
			add_character_modifier = {
				name = quest_cooldown_timer
				hidden = yes
				days = 1000
			}
		}
		ai_chance = { factor = 0 }
	}
}