namespace = dag_cdo_slave_pit_fighter

# 0001. Owners get earnings from their slave-pit fighters

dag_cdo_slave_pit_fighter.0001 = {
	hidden = yes

	trigger = {
		any_relation = {
			type = slave
			dag_cdo_is_working_as_pit_fighter_trigger = yes
		}
	}

	immediate = {
		set_variable = {
			name = dag_cdo_slave_pit_fighter_earnings
			value = 0
		}
		set_variable = {
			name = dag_cdo_slave_pit_fighter_piety_lost
			value = 0
		}
		every_relation = {
			type = slave
			hidden_effect = {
				# unlanded characters don't actually earn money, so we have to generate money out of nothing in script
				root = {
					change_variable = {
						name = dag_cdo_slave_pit_fighter_earnings
						add = prev.dag_cdo_slave_pit_fighter_income_value
					}
				}
#				if = {
#					limit = {
#						root.faith = {
#							NOT = { has_doctrine = dag_cdo_doctrine_pit_fighter_accepted }
#						}
#					}
#					root = {
#						change_variable = {
#							name = dag_cdo_slave_pit_fighter_piety_lost
#							add = miniscule_piety_loss
#						}
#					}
#				}
				if = {
					limit = {
						OR = {
							root.faith = {
								NOT = { has_doctrine = carn_doctrine_same_slavery_accepted }
								faith_hostility_level = {
									target = prev.faith
									value < faith_hostile_level
								}
							}
							root.faith = {
								NOT = { has_doctrine = carn_doctrine_other_slavery_accepted }
								faith_hostility_level = {
									target = prev.faith
									value >= faith_hostile_level
								}
							}
						}
					}
					root = {
						change_variable = {
							name = dag_cdo_slave_pit_fighter_piety_lost
							add = miniscule_piety_loss
						}
					}
				}
			}
		}
		send_interface_message = {
			type = dag_cdo_pit_fighter_random_event_good
			title = dag_cdo_slave_pit_fighter.0001.t
			add_gold = var:dag_cdo_slave_pit_fighter_earnings
			add_piety = var:dag_cdo_slave_pit_fighter_piety_lost
			stress_impact = {
				generous = medium_stress_impact_gain
				compassionate = major_stress_impact_gain
			}
		}
	}
}