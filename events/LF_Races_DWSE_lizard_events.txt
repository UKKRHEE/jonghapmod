namespace = dwseliz


character_event = {
	id = dwseliz.1
	picture = GFX_evt_cathedral
	desc = dwseliz1Choice
	is_triggered_only = yes
	option = {
		name = dwseliz1ChoiceTTA
		trigger = {
			lf_races_dwse_active = yes
		}
		narrative_event = { id = dwseliz.12 }
	}
	option = {
		name = dwseliz1ChoiceTTB
		trigger = {
			lf_races_dwse_active = yes
		}
		narrative_event = { id = dwseliz.13 }
	}
}

narrative_event = {
	id = dwseliz.12
	picture = dragon_flight
	is_triggered_only = yes # Triggered by Decision
	title = dwseliz12T	
	desc = dwseliz12
	option = { 
		name = dwseliz12C
		if = {
			limit = {
				is_adult = yes
			}
			add_trait = dwse_dragon_adult
			hidden_effect = {
				add_random_dwse_dragon_portrait = yes
			}
		}
		else = {
			add_trait = dwse_dragon_child
		}
	}
}

	
narrative_event = {
	id = dwseliz.13
	picture = lf_a_placeholder # should be overwritten by the desc multipath
	is_triggered_only = yes # Triggered by Decision
	title = dwse_lizard_start_title	
	desc = {
		trigger = {
			is_female = no # Male
		}
		text = dwseliz1m
		picture = aura_male
	}
	desc = {
		trigger = {
			is_female = yes # Female
		}
		text = dwseliz1f
		picture = aura_female
	}
	option = { 
		name = dwseliz1A
		add_trait = dwse_lizard
		hidden_effect = {
			add_random_dwse_lizard_portrait = yes
		}
		custom_tooltip = {
			text = LFAllRealmCharacters
		}
		hidden_tooltip = {
			character_event = { id = dwseliz.11 }
		}
	}
	option = {
		trigger = {
			any_demesne_province = {
				port = yes
			}
		}
		tooltip_info_custom = dwse_coastal_tt
		name = dwseliz1B
		add_trait = dwse_lizard
		custom_tooltip = {
			text = LFDWSEDawnStart
			culture = dwse_dawn
		}
		hidden_tooltip = {
			add_random_dwse_lizard_portrait = yes
		}
		custom_tooltip = {
			text = LFAllRealmCharacters
		}
		hidden_tooltip = {
			character_event = { id = dwseliz.11 }
			character_event = { id = dwseliz.14 }
		}
	}
	option = {
		trigger = {
			any_demesne_province = {
				OR = {
					terrain = plains
					terrain = steppe
					terrain = farmlands
				}
			}
		}
		tooltip_info_custom = dwse_flatland_tt
		name = dwseliz1C
		add_trait = dwse_lizard
		custom_tooltip = {
			text = LFDWSEDuskStart
			culture = dwse_dusk
		}
		hidden_tooltip = {
			add_random_dwse_lizard_portrait = yes
		}
		custom_tooltip = {
			text = LFAllRealmCharacters
		}
		hidden_tooltip = {
			character_event = { id = dwseliz.11 }
			character_event = { id = dwseliz.14 }
		}
	}
	after = {
		if = {
			limit = {
				has_global_flag = LFGenderBendOn
			}
			set_character_flag = lf_aura_genderbend
		}
	}
}

character_event = {
	id = dwseliz.11
	hide_window = yes
	is_triggered_only = yes # Triggered by Decision
	immediate = {
		any_realm_character = {
			limit = {
				any_liege = { character = ROOT }
			}
			if = {
				limit = {
					ROOT = {
						culture = dwse_dawn
					}
				}
				character_event = { id = LFSeeding.12 }
			}
			else_if = {
				limit = {
					ROOT = {
						culture = dwse_dusk
					}
				}
				character_event = { id = LFSeeding.14 }
			}
			else = {
				character_event = { id = LFSeeding.15 }
			}
		}
	}
}

character_event = {
	id = dwseliz.14
	picture = {
		trigger = {
			culture = dwse_dawn
		}
		picture = GFX_evt_ship_voyage_hf
	}
	picture = {
		trigger = {
			culture = dwse_dusk
		}
		picture = GFX_evt_mounted_combat_hf
	}
	desc = LF_Race_Convert_Culture
	is_triggered_only = yes
	option = { # Yourself and your province(s)
		name = LF_Race_Convert_Provinces
		custom_tooltip = {
			text = LFAllRealmProvincesCulture
			if = {
				limit = {
					culture = dwse_dawn
				}
				any_demesne_province = {
					culture = dwse_dawn
				}
			}
			else = {
				any_demesne_province = {
					culture = dwse_dusk
				}
			}	
		}
	}
	option = { # Everyone
		name = LF_Race_Convert_Everything
		custom_tooltip = {
			text = LFAllCulture
			if = {
				limit = {
					culture = dwse_dawn
				}
				any_demesne_province = {
					culture = dwse_dawn
				}
				hidden_tooltip = {
					any_realm_character = {
						limit = {
							any_liege = {
								character = ROOT
							}
						}
						culture = dwse_dawn
						if = {
							limit = {
								is_ruler = yes
							}
							any_demesne_province = {
								culture = dwse_dawn
							}
						}
					}
				}
			}
			else = {
				any_demesne_province = {
					culture = dwse_dusk
				}
				hidden_tooltip = {
					any_realm_character = {
						limit = {
							any_liege = {
								character = ROOT
							}
						}
						culture = dwse_dusk
						if = {
							limit = {
								is_ruler = yes
							}
							any_demesne_province = {
								culture = dwse_dusk
							}
						}
					}
				}
			}	
		}
	}
	option = { # Remain as you are
		name = LF_Race_Convert_Nothing
	}
}


character_event = {
	id = dwseliz.2
	is_triggered_only = yes  
	hide_window = yes 
	immediate = {
		if = {
			limit = {
				trait = dwse_lizard
			}
			if = {
				limit = {
					OR = {
						trait = dwse_raen_child
						culture = dwse_dawn
					}
				}
				remove_trait = dwse_raen_child
				add_random_dwse_raen_portrait = yes
			}
			else_if = {
				limit = {
					culture = dwse_dusk
				}
				add_random_dwse_xaela_portrait = yes
			}
			else = {
				add_random_dwse_lizard_portrait = yes
			}
		}
	}
}
character_event = {
	id = dwseliz.3
	is_triggered_only = yes  
	hide_window = yes 
	immediate = {
		if = {
			limit = {
				mother = { 
					trait = dwse_lizard_pregnancy 
				}
			}
			mother = { 
				remove_trait = dwse_lizard_pregnancy 
			}
			add_trait = dwse_lizard
			mother = {
				ROOT = {
					culture = PREV
					set_graphical_culture = PREV
					dynasty = PREV
					religion = PREV
				}
			}
			remove_trait = bastard
			remove_trait = legit_bastard
			character_event = { id = dwseliz.4 days = 1 }
		}
	}
}
character_event = {
	id = dwseliz.4
	is_triggered_only = yes  
	hide_window = yes 
	immediate = {
		remove_trait = bastard
		remove_trait = legit_bastard
		add_trait = dwse_lizard
		mother = {
			ROOT = {
				culture = PREV
				set_graphical_culture = PREV
				dynasty = PREV
				religion = PREV
			}
		}
	}
}

narrative_event = {
	id = dwseliz.5
	picture = dwse_regen 
	is_triggered_only = yes 
	title = dwse_lizard_regen
	desc = dwseliz5
	trigger = {
		is_adult = yes
		OR = {
			trait = dwse_dragon_adult
			trait = dwse_lizard
		}
		OR = {
			trait = inbred
			trait = incapable
			trait = infirm
			trait = maimed
			trait = wounded
			trait = leper
			trait = disfigured
			trait = mangled
			trait = one_eyed
			trait = one_handed
			trait = one_legged
			trait = blinded
			trait = eunuch
			has_character_modifier = mild_illness
			has_character_modifier = severe_illness
			has_character_modifier = bedridden_illness
		}
	}
	option = { 
		name = dwseliz5a
		hidden_tooltip = { 
			remove_trait = inbred
			remove_trait = incapable
			remove_trait = infirm
			remove_trait = maimed
			remove_trait = wounded
			remove_trait = leper
			remove_trait = disfigured
			remove_trait = mangled
			remove_trait = one_eyed
			remove_trait = one_handed
			remove_trait = one_legged
			remove_trait = blinded
			remove_trait = eunuch
			clear_disease_level_effect = yes
		}
	}
}


###Imperial marriage

#Randomizing the spouse 
character_event = {
    id = dwseliz.20045
	has_dlc = "Jade Dragon"
    hide_window = yes
    is_triggered_only = yes
    immediate = { 

        FROMFROMFROM  = { save_event_target_as = imperial_marriage_spouse_1 }

        offmap_dwse = {
            offmap_ruler = { 
				save_event_target_as = IS_RULLER_OF_DWSE
			}
		}	
        offmap_dwse = {
            offmap_ruler = { 
                ROOT = {
                    if = {
                        limit = { event_target:imperial_marriage_spouse_1 = { is_female = yes } }
                        create_character = {
                            age = 16
                            dynasty = PREV
                            religion = PREV
                            culture = PREV
                            female = no
                            health = 6
                            random_traits = no
                            attributes = {
                                martial = 4
                                diplomacy = 5
                                stewardship = 4
                                intrigue = 4
                                learning = 5
                            }
                        }
                    }
                    if = {
                        limit = { event_target:imperial_marriage_spouse_1 = { is_female = no } }
                        create_character = {
                            age = 16
                            dynasty = PREV
                            religion = PREV
                            culture = PREV
                            female = yes
                            health = 6
                            random_traits = no
                            attributes = {
                                martial = 4
                                diplomacy = 5
                                stewardship = 4
                                intrigue = 4
                                learning = 5
                            }
                        }
                    }
                    new_character = {
						set_character_flag = always_show_in_marriage_selection
                        save_event_target_as = imperial_marriage_spouse_2
                        add_trait = cannot_marry #Is removed upon marriage
						set_character_flag = ai_flag_refuse_concubinage
						set_character_flag = ai_flag_refuse_marriage

                        set_character_flag = chinese_honor_guard
						
						set_character_flag = originated_from_chinese_court
						set_character_flag = chinese_courtier_original_court_@PREV
						set_character_flag = is_chinese_imperial_marriage
						
						add_trait = child_of_consort
						
						if = {
							limit = {
								event_target:imperial_marriage_spouse_1 = {
									religion = hindu
								}
							}
							add_trait = kshatriya
						}

                        PREVPREV = { #Emperor/Empress
							trigger_switch = {
								on_trigger = is_female
								yes = {
									if = { #If Empress has father make them siblings
										limit = {
											father_even_if_dead = {
												could_be_parent_of = event_target:imperial_marriage_spouse_2
											}
										}
										father_even_if_dead = { save_event_target_as = imperial_marriage_parent }
									}
									else_if = { #Else if Emperor has a grandfather make them siblings
										limit = {
											father_even_if_dead = {
												father_even_if_dead = {
													could_be_parent_of = event_target:imperial_marriage_spouse_2
												}
											}
										}
										father_even_if_dead = {
											father_even_if_dead = {
												save_event_target_as = imperial_marriage_parent
											}
										}
									}
									else_if = {
										limit = {
											any_dynasty_member_even_if_dead  = {
												is_or_was_offmap_power_ruler = yes
												could_be_parent_of = event_target:imperial_marriage_spouse_2
											}
										}
										random_dynasty_member_even_if_dead = {
											limit = {
												is_or_was_offmap_power_ruler = yes
												could_be_parent_of = event_target:imperial_marriage_spouse_2
											}
											save_event_target_as = imperial_marriage_parent
										}
									}
									else_if = {
										limit = {
											any_dynasty_member_even_if_dead  = {
												could_be_parent_of = event_target:imperial_marriage_spouse_2
											}
										}
										random_dynasty_member_even_if_dead = {
											limit = {
												could_be_parent_of = event_target:imperial_marriage_spouse_2
											}
											save_event_target_as = imperial_marriage_parent
										}
									}
									else_if = { #Else make a new father to make them siblings
										limit = {
											father_even_if_dead = {
												always = no
											}
										}
										create_character = {
											age = 60
											dynasty = PREV
											religion = PREV
											culture = PREV
										}
										new_character = { 
											death = { death_reason = death_in_china_historic }
											save_event_target_as = imperial_marriage_parent
										}
										set_father = event_target:imperial_marriage_parent
										if = {
											limit = {
												event_target:imperial_marriage_parent = {
													trait = yiminhyee
												}
												offmap_dwse = {
													offmap_ruler = {
														trait = dougther_of_minhyee_6
													}
												}
											}
											set_mother = event_target:IS_RULLER_OF_DWSE
										}
									}
								}
								no = {
									if = { #If Emperor is 32+ and the imperial target is female then make it his child
										limit = {
											could_be_parent_of = event_target:imperial_marriage_spouse_2
											event_target:imperial_marriage_spouse_2 = {
												is_female = yes
											}
										}
										save_event_target_as = imperial_marriage_parent
									}
									else_if = { #Else if Emperor has a father make them siblings
										limit = {
											father_even_if_dead = {
												could_be_parent_of = event_target:imperial_marriage_spouse_2
											}
										}
										father_even_if_dead = {
											save_event_target_as = imperial_marriage_parent
										}
									}
									else_if = { #Else if Emperor has a grandfather make them siblings
										limit = {
											father_even_if_dead = {
												father_even_if_dead = {
													could_be_parent_of = event_target:imperial_marriage_spouse_2
												}
											}
										}
										father_even_if_dead = {
											father_even_if_dead = {
												save_event_target_as = imperial_marriage_parent
											}
										}
									}
									else_if = {
										limit = {
											any_dynasty_member_even_if_dead = {
												is_or_was_offmap_power_ruler = yes
												could_be_parent_of = event_target:imperial_marriage_spouse_2
											}
										}
										random_dynasty_member_even_if_dead = {
											limit = {
												is_or_was_offmap_power_ruler = yes
												could_be_parent_of = event_target:imperial_marriage_spouse_2
											}
											save_event_target_as = imperial_marriage_parent
										}
									}
									else_if = {
										limit = {
											any_dynasty_member_even_if_dead = {
												could_be_parent_of = event_target:imperial_marriage_spouse_2
											}
										}
										random_dynasty_member_even_if_dead = {
											limit = {
												could_be_parent_of = event_target:imperial_marriage_spouse_2
											}
											save_event_target_as = imperial_marriage_parent
										}
									}
									else_if = { #Else make a new father to make them siblings
										limit = {
											father_even_if_dead = {
												always = no
											}
										}
										create_character = {
											age = 60
											dynasty = PREV
											religion = PREV
											culture = PREV
										}
										new_character = { 
											death = { death_reason = death_in_china_historic }
											save_event_target_as = imperial_marriage_parent
										}
										set_father = event_target:imperial_marriage_parent
										if = {
											limit = {
												event_target:imperial_marriage_parent = {
													trait = yiminhyee
												}
												offmap_dwse = {
													offmap_ruler = {
														trait = dougther_of_minhyee_6
													}
												}
											}
											set_mother = event_target:IS_RULLER_OF_DWSE
										}
									}
								}
                            }
							if = {
								limit = {
									event_target:imperial_marriage_parent = {
										is_female = no
									}
								}
								event_target:imperial_marriage_spouse_2 = { set_father = event_target:imperial_marriage_parent }
										if = {
											limit = {
												event_target:imperial_marriage_parent = {
													trait = yiminhyee
												}
												offmap_dwse = {
													offmap_ruler = {
														trait = dougther_of_minhyee_6
													}
												}
											}
											set_mother = event_target:IS_RULLER_OF_DWSE
										}
							}
							if = {
								limit = {
									event_target:imperial_marriage_parent = {
										is_female = yes
									}
								}
								event_target:imperial_marriage_spouse_2 = { set_mother = event_target:imperial_marriage_parent }
										if = {
											limit = {
												event_target:imperial_marriage_parent = {
													trait = yiminhyee
												}
												offmap_dwse = {
													offmap_ruler = {
														trait = dougther_of_minhyee_6
													}
												}
											}
											set_mother = event_target:IS_RULLER_OF_DWSE
										}
							}
                        }

                        #Positive genetic trait
                        random_list = {
                            60 = { 
								trigger = { 
									NOT = { offmap_dwse = { has_status = china_golden_age } } 
								}  
								#Nothing 
							}
                            15 = { add_trait = fair }
                            5 = { add_trait = strong }
                            10 = { add_trait = quick }
                            5 = { add_trait = genius }
                        }

                        #Negative genetic trait
						random_list = {
							90 = { } #Nothing
							1 = { add_trait = clubfooted }
							1 = { add_trait = harelip }
							1 = { add_trait = hunchback }
							1 = { add_trait = lisp }
							2 = { add_trait = stutter }
							1 = { 
								remove_trait = fair
								add_trait = ugly 
							}
							1 = { add_trait = dwarf }
							1 = { 
								remove_trait = genius
								remove_trait = quick
								add_trait = slow 
							}
							1 = { 
								remove_trait = strong
								add_trait = weak 
							}
						}

                        random = {
                            chance = 5
                            add_trait = homosexual
                        }

                        #Add archetype 1 (personality: conservative, supportive, decisive, sociable)
                        random_list = {
                            #Conservative 
                            25 = {
                                set_character_flag = archetype_conservative
                                
                                random = {
                                    chance = 50
                                    add_trait = zealous
                                }
                                add_trait = temperate
                                random_list = {
                                    20 = { add_trait = greedy }
                                    20 = { add_trait = wroth }
                                    20 = { add_trait = deceitful }
                                    20 = { add_trait = stubborn }
                                    20 = { add_trait = cruel }
                                }
                                random_list = {
                                    25 = { add_trait = poet }
                                    25 = { add_trait = chaste }
                                    25 = { 
                                        add_trait = patient
                                        remove_trait = wroth
                                    }
                                    25 = { add_trait = just }
                                }
                            }
                            #Supportive
                            25 = {
                                set_character_flag = archetype_supportive
                                
                                add_trait = humble
                                add_trait = patient
                                random_list = {
                                    30 = { add_trait = slothful }
                                    70 = { add_trait = shy }
                                }
                                random_list = {
                                    25 = { add_trait = content }
                                    25 = { add_trait = charitable }
                                    25 = { add_trait = kind }
                                    25 = { add_trait = trusting }
                                }      
                            }
                            #Decisive
                            25 = {
                                modifier = {
                                    is_female = yes
                                    NOT = {
                                        has_game_rule = {
                                            name = gender
                                            value = all
                                        }
                                    }
                                    factor = 0.5
                                }
                                set_character_flag = archetype_decisive
                                
                                add_trait = ambitious
                                add_trait = cynical
                                random_list = {
                                    20 = { add_trait = cruel }
                                    20 = { add_trait = stubborn }
                                    20 = { add_trait = greedy }
                                    20 = { add_trait = wroth }
                                    20 = { add_trait = proud }
                                }
                                random_list = {
                                    20 = { add_trait = falconer }
                                    20 = { add_trait = diligent }
                                    20 = { add_trait = brave }
                                    20 = { add_trait = honest }
                                    20 = { add_trait = gregarious }
                                }    
                            }
                            #Sociable
                            25 = {
                                modifier = {
                                    is_female = yes
                                    NOT = {
                                        has_game_rule = {
                                            name = gender
                                            value = all
                                        }
                                    }
                                    factor = 0.7
                                }
                                set_character_flag = archetype_sociable
                                
                                add_trait = gregarious
                                add_trait = charitable
                                random_list = {
                                    25 = { add_trait = envious }
                                    25 = { add_trait = gluttonous }
                                    25 = { add_trait = proud }
                                    25 = { add_trait = slothful }
                                }
                                random_list = {
                                    33 = { add_trait = kind }
                                    33 = { add_trait = honest }
                                    33 = { add_trait = lustful }
                                }   
                            }
                        }

                        #Set archetype 2 (lifestyle)
                        random_list = {
                            #War
                            15 = {
                                modifier = {
                                    is_female = yes
                                    NOT = {
                                        has_game_rule = {
                                            name = gender
                                            value = all
                                        }
                                    }
                                    factor = 0.1
                                }
                                modifier = {
                                    has_character_flag = archetype_decisive
                                    factor = 2
                                }
                                #Set education
                                random_list = {
                                    30 = { add_trait = tough_soldier }
                                    50 = { add_trait = skilled_tactician }
                                    20 = { add_trait = brilliant_strategist }
                                }
                                #Set appropriate traits
                                random_list = {
                                    33 = {
                                        if = {
                                            limit = { has_dlc = "Way of Life" }
                                            add_trait = duelist
                                        }
                                        remove_trait = craven
                                        add_trait = brave
                                        if = {
                                            limit = { is_strong_trigger = no }
                                            add_trait = robust
                                        }
                                    }
                                    33 = {
                                        if = {
                                            limit = { has_dlc = "Way of Life" }
                                            add_trait = hunter
                                        }
                                        add_trait = falconer
                                        if = {
                                            limit = { is_strong_trigger = no }
                                            add_trait = robust
                                        }
                                    }
                                    33 = {
                                        if = {
                                            limit = { has_dlc = "Way of Life" }
                                            add_trait = strategist
                                        }
                                        if = {
                                            limit = { is_smart_trigger = no }
                                            add_trait = shrewd
                                        }
                                    }
                                }      
                            }

                            #Diplomacy
                            30 = {
                                modifier = {
                                    has_character_flag = archetype_supportive
                                    factor = 1.5
                                }
                                modifier = {
                                    has_character_flag = archetype_sociable
                                    factor = 2
                                }
                                #Set education
                                random_list = {
                                    30 = { add_trait = underhanded_rogue }
                                    50 = { add_trait = charismatic_negotiator }
                                    20 = { add_trait = grey_eminence }
                                }
                                random = {
                                    chance = 30
                                    add_trait = arbitrary
                                }
                                #Set appropriate traits
                                random_list = {
                                    33 = {
                                        if = {
                                            limit = { has_dlc = "Way of Life" }
                                            add_trait = hedonist
                                        }
                                        remove_trait = chaste
                                        add_trait = lustful
                                    }
                                    33 = {
                                        if = {
                                            limit = { has_dlc = "Way of Life" }
                                            add_trait = socializer
                                        }
                                        add_trait = gregarious
                                        remove_trait = shy
                                    }
                                    33 = {
                                        if = {
                                            limit = { has_dlc = "Way of Life" }
                                            add_trait = gamer
                                        }
                                        if = {
                                            limit = { is_smart_trigger = no }
                                            add_trait = shrewd
                                        }
                                    }
                                }      
                            }

                            #Intrigue
                            10 = {
                                modifier = {
                                    has_character_flag = archetype_supportive
                                    factor = 0.5
                                }
                                modifier = {
                                    has_character_flag = archetype_decisive
                                    factor = 1.5
                                }
                                modifier = {
                                    has_character_flag = archetype_sociable
                                    factor = 1.5
                                }
                                #Set education
                                random_list = {
                                    30 = { add_trait = flamboyant_schemer }
                                    50 = { add_trait = intricate_webweaver }
                                    20 = { add_trait = elusive_shadow }
                                }
                                #Set appropriate traits
                                random_list = {
                                    33 = {
                                        trigger = { NOT = { has_character_flag = archetype_supportive } } 
                                        if = {
                                            limit = { has_dlc = "Way of Life" }
                                            add_trait = impaler
                                        }
                                        random = {
                                            chance = 50
                                            add_trait = arbitrary
                                        }
                                        remove_trait = kind
                                        add_trait = cruel
                                    }
                                    33 = {
                                        if = {
                                            limit = { has_dlc = "Way of Life" }
                                            add_trait = schemer
                                        }
                                        add_trait = deceitful
                                        remove_trait = honest
                                    }
                                    33 = {
                                        if = {
                                            limit = { has_dlc = "Way of Life" }
                                            if = {
                                                limit = { is_female = yes }
                                                add_trait = seductress
                                            }
                                            if = {
                                                limit = { is_female = no }
                                                add_trait = seducer
                                            }
                                        }
                                        remove_trait = chaste
                                        add_trait = lustful
                                    }
                                }      
                            }

                            #Stewardship
                            20 = {
                                modifier = {
                                    has_character_flag = archetype_conservative
                                    factor = 0.5
                                }
                                #Set education
                                random_list = {
                                    30 = { add_trait = thrifty_clerk }
                                    50 = { add_trait = fortune_builder }
                                    20 = { add_trait = midas_touched }
                                }
                                #Set appropriate traits
                                random_list = {
                                    33 = {
                                        if = {
                                            limit = { has_dlc = "Way of Life" }
                                            add_trait = gardener
                                        }
                                        remove_trait = slothful
                                        add_trait = diligent
                                    }
                                    33 = {
                                        if = {
                                            limit = { has_dlc = "Way of Life" }
                                            add_trait = architect
                                        }
                                        add_trait = ambitious
                                        remove_trait = content
                                    }
                                    33 = {
                                        if = {
                                            limit = { has_dlc = "Way of Life" }
                                            add_trait = administrator
                                        }
                                        add_trait = erudite
                                    }
                                }      
                            }

                            #Learning
                            25 = {
                                modifier = {
                                    has_character_flag = archetype_conservative
                                    factor = 2
                                }
                                #Set education
                                random_list = {
                                    30 = { add_trait = martial_cleric }
                                    50 = { add_trait = scholarly_theologian }
                                    20 = { add_trait = mastermind_theologian }
                                }
                                #Set appropriate traits
                                random_list = {
                                    33 = {
                                        if = {
                                            limit = { has_dlc = "Way of Life" }
                                            add_trait = scholar
                                        }
                                        add_trait = erudite
                                    }
                                    33 = {
                                        if = {
                                            limit = { has_dlc = "Way of Life" }
                                            add_trait = mystic
                                        }
                                        add_trait = paranoid
                                        remove_trait = trusting
                                    }
                                    33 = {
                                        if = {
                                            limit = { has_dlc = "Way of Life" }
                                            add_trait = theologian
                                        }
                                        add_trait = erudite  
                                    }
                                }      
                            }
                        }
						
						if = {
							limit = {
								offmap_dwse = {
									has_status = china_golden_age
								}
							}
							change_diplomacy = 3
							change_martial = 3
							change_stewardship = 3
							change_intrigue = 3
							change_learning = 3
						}

                        #Sympathy
                        if = {
                            limit = { NOT = { trait = zealous } }
                            event_target:imperial_marriage_spouse_1 = { event_target:imperial_marriage_spouse_2 = { add_sympathy_for_prevs_open_religion_effect = yes } }
                        }
                    }
                }
            }
        }

        FROMFROM = { #The arranger of the marriage
            letter_event = { id = dwseliz.20046 } 
        } 
    }
}

#The spouse is on its way
letter_event = {
    id = dwseliz.20046
	has_dlc = "Jade Dragon"
    border = GFX_event_letter_frame_diplomacy

    desc = {
        trigger = {
			event_target:imperial_marriage_spouse_2 = { is_female = yes }
			offmap_dwse = { offmap_ruler = { age = 32 } }
		}
        text = EVTDESC_JD_20046_A
    }
    desc = {
        trigger = { event_target:imperial_marriage_spouse_2 = { is_female = no } }
        text = EVTDESC_JD_20046_B
    }
	desc = {
        trigger = {
			event_target:imperial_marriage_spouse_2 = { is_female = yes }
			offmap_dwse = { offmap_ruler = { NOT = { age = 32 } } }
		}
        text = EVTDESC_JD_20046_C
    }

    is_triggered_only = yes
    
    option = { 
        name = EVTOPTA_JD_20046
        custom_tooltip = { text = EVTOPTA_JD_20046_TT }

        hidden_effect = {
            event_target:imperial_marriage_spouse_2 = { character_event = { id = dwseliz.20047 days = 14 random = 10 } } 
        }
    }
}

#The chinese spouse ping event
character_event = {
    id = dwseliz.20047
	has_dlc = "Jade Dragon"
    hide_window = yes
    is_triggered_only = yes
    immediate = { 
        if = {
            limit = { is_female = yes }
            add_character_modifier = {
                name = jd_princess
                duration = -1
            }
        }
        if = {
            limit = { is_female = no }
            add_character_modifier = {
                name = jd_prince
                duration = -1
            }
        }
        remove_trait = cannot_marry
        event_target:imperial_marriage_spouse_1 = { 
            remove_trait = cannot_marry
            narrative_event = { id = dwseliz.20048 } 
        } 
    }
}
 
#The marriage takes place
narrative_event = {
    id = dwseliz.20048
	has_dlc = "Jade Dragon"
    title = EVTTITLE_JD_20048
    picture = GFX_evt_china_golden_age
    border = GFX_event_narrative_frame_diplomacy

    desc = {
        trigger = { FROM = { has_character_flag = archetype_conservative } }
        text = EVTDESC_JD_20048_CONSERVATIVE
    }
    desc = {
        trigger = { FROM = { has_character_flag = archetype_supportive } }
        text = EVTDESC_JD_20048_SUPPORTIVE
    }
    desc = {
        trigger = { FROM = { has_character_flag = archetype_decisive } }
        text = EVTDESC_JD_20048_DECISIVE
    }
    desc = {
        trigger = { FROM = { has_character_flag = archetype_sociable } }
        text = EVTDESC_JD_20048_SOCIABLE
    }

    is_triggered_only = yes
    

    option = { 
        name = EVTOPTA_JD_20048

        #Marry
        if = {
            limit = { is_female = yes }
            add_spouse_matrilineal = event_target:imperial_marriage_spouse_2
        }
        if = {
            limit = { is_female = no }
            add_spouse = event_target:imperial_marriage_spouse_2
        }

        #Prestige
        prestige = 500

        #Peace Deal
        if = {
            limit = { FROMFROM = { character = ROOT } }
            custom_tooltip = {
                text = chinese_imperial_marriage_peace_deal_effect_tt
                add_character_modifier = {
                    inherit = yes
                    name = peace_deal_with_china
                    years = 50
                }
            }
        }

        hidden_effect = { FROMFROM = { character_event = { id = dwseliz.20049 } } } #Letting the decision taker know
        clr_character_flag = awaiting_imperial_wedding
    }
}

#Anouncement
character_event = {
    id = dwseliz.20049
	has_dlc = "Jade Dragon"
    desc = EVTDESC_JD_20049
    picture = GFX_evt_china_golden_age
    border = GFX_event_normal_frame_diplomacy

    is_triggered_only = yes
    
    trigger = {
        NOT = { character = FROM }
    }

    option = {
        name = EVTOPTA_JD_20049
        custom_tooltip = { text = EVTOPTA_JD_20049_TT }
        custom_tooltip = {
            text = chinese_imperial_marriage_peace_deal_effect_tt
            add_character_modifier = {
                inherit = yes
                name = peace_deal_with_china
                years = 50
            }
        }
        FROM = {
            show_portrait = yes
        }
        event_target:imperial_marriage_spouse_2 = {
            show_portrait = yes
        }
    }
}