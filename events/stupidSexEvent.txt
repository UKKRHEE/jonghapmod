namespace = stupidSexEventMod

scripted_trigger valid_stupid_sex_target = {
	NOT = {
		has_trait = chaste
	}
}

stupidSexEventMod.1001 = {
    type = character_event
    title = stupidSexEventMod.1001.title
    desc = stupidSexEventMod.1001.desc
    theme = hunt_activity

    left_portrait = {
        character = scope:red_riding_hood
        animation = scared
    }

    trigger = {
		NOT = { has_character_flag = ran_into_red_riding_hood }
        # Not planning to balance anything for ai, so might as stop everything non-player
        is_ai = no
		is_adult = yes
        # I don't have the localisation to support a female view.
		is_male = yes
		NOR = {
			has_sexuality = asexual
			has_trait = celibate
		}
    }

    weight_multiplier = {
		base = 1

		modifier = {
			add = 0.5
			is_ai = no
			has_trait = lustful
		}
		compare_modifier = { #Less likely to happen the older you are
			trigger = {
				age >= 30
			}
			value = age
			multiplier = -0.01
		}
	}

    immediate = {

		add_character_flag = {
			flag = ran_into_red_riding_hood
			days = 3650
		}

		hidden_effect = {
			create_character = {
				location = scope:activity.activity_province
				template = beautiful_peasant_character
				gender_female_chance = 100
				faith = scope:activity.activity_province.county.faith
				culture = scope:activity.activity_province.county.culture
				dynasty = none
				save_scope_as = red_riding_hood
			}
            scope:red_riding_hood = { set_sexuality = heterosexual }
		}

    }

    option = {
        trigger = {
        }
        name = stupidSexEventMod.1001.a
		flavor = stupidSexEventMod.1001.a.tt
		stress_impact = {
			brave = minor_stress_impact_loss
			craven = medium_stress_impact_gain
			compassionate = minor_stress_impact_loss
		}
		trigger_event = {
			id = stupidSexEventMod.1002
			days = { 1 3 }
		}

    }
    option = {
        trigger = {
        }
        name = stupidSexEventMod.1001.c
		flavor = stupidSexEventMod.1001.c.tt

		stress_impact = {
			compassionate = medium_stress_impact_gain
			sadistic = minor_stress_impact_loss
		}
    }

    after = {
        scope:target_stupid_sex_target = {
            remove_character_flag = is_naked
        }
    }

}


stupidSexEventMod.1002 = {
    type = character_event
    title = stupidSexEventMod.1002.title
    desc = stupidSexEventMod.1002.desc
    theme = hunt_activity

    left_portrait = {
        character = scope:red_riding_hood
        animation = flirtation
    }


    immediate = {


    }

    option = {
        trigger = {
        }
        name = stupidSexEventMod.1002.a
		flavor = stupidSexEventMod.1002.a.tt

		stress_impact = {
			lustful = minor_stress_impact_gain
			just = minor_stress_impact_loss
		}
    }
    option = {
        trigger = {
        }
        name = stupidSexEventMod.1002.b

		trigger_event = {
			id = stupidSexEventMod.1003
			days = { 1 3 }
		}
    }

    after = {
        scope:target_stupid_sex_target = {
            remove_character_flag = is_naked
        }
    }

}

stupidSexEventMod.1003 = {
    type = character_event
    title = stupidSexEventMod.1003.title
    desc = stupidSexEventMod.1003.desc
    theme = hunt_activity

    trigger = {
        is_adult = yes 
        scope:red_riding_hood = { is_adult = yes }
    }

	right_portrait = {
		character = scope:carn_sex_male
		animation = sex_missionary
		outfit_tags = { no_cloak no_hat no_pants topless }
	}
	left_portrait = {
		CHARACTER = scope:carn_sex_female
		animation = sex_missionary
		outfit_tags = { no_cloak no_hat no_pants topless }
	}



	immediate = { 
        scope:red_riding_hood = {
            save_scope_as = carn_sex_female
        }
        ROOT = {
            save_scope_as = carn_sex_male
        }
		if = {
			limit = {
				Not = { exists = global_var:sex_animation_event }
			}
			set_global_variable = {
				name = sex_animation_event
				value = 1
			}
		}
		else_if = {
			limit = {
				exists = global_var:sex_animation_event
			}
			change_global_variable = {
				name = sex_animation_event
				add = 1
			}
		}
		carn_had_sex_with_effect = {
			CHARACTER_1 = scope:carn_sex_male
			CHARACTER_2 = scope:carn_sex_female
			C1_PREGNANCY_CHANCE = full_pregnancy_chance
			C2_PREGNANCY_CHANCE = full_pregnancy_chance
			STRESS_EFFECTS = scope:carn_sex_stress_effects
			DRAMA = scope:carn_sex_drama
		}
	}


    option = {
        trigger = {
        }
        name = stupidSexEventMod.1003.a
		flavor = stupidSexEventMod.1003.a.tt

		if = {
			limit = {
				exists = global_var:sex_animation_event
				trigger_if = {
					limit = { exists = global_var:sex_animation_event }
					global_var:sex_animation_event = 1
				}
			}
			remove_global_variable = sex_animation_event
		}
		else_if = {
			limit = {
				exists = global_var:sex_animation_event
			}
			change_global_variable = {
				name = sex_animation_event
				add = -1
			}
		}
    }

    after = {
        scope:target_stupid_sex_target = {
            remove_character_flag = is_naked
        }
    }

}
