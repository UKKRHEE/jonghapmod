namespace = dag_cdo_prostitute_event

#~Events in this file are intended to be called by other events
#~Most require passing some existing scopes

#####################
# Summon a particular_whore to your chambers
# by Dagulus
# 1001
#####################

dag_cdo_prostitute_event.1001 = {
	type = character_event
	title = dag_cdo_prostitute_event.1001
	desc = dag_cdo_prostitute_event.1001.desc
	theme = seduction

	left_portrait = {
        character = root
        animation = personality_rational
    }

    right_portrait = {
        character = scope:particular_whore
        animation = flirtation
    }

    immediate = {
        scope:particular_whore = {
            add_character_flag = {
                flag = is_naked
                days = 1
            }
        }
    }

    option = {
        name = dag_cdo_prostitute_event.1001.a

		#~work on some proper localization for female players later
		trigger = { is_female = yes }
		dag_cdo_pay_prostitute_effect = { PROSTITUTE = scope:particular_whore }
		carn_sex_scene_request_vaginal = yes
		dag_cdo_pressured_sex_effect = {
			PLAYER = root
			TARGET = scope:particular_whore
		}
    }

	#~ At better way to approach this may be to base it on the fetish system: IE.
	#>Option A: straight sex
	#>Option B: demand player fetish
	#>Option C: accept whore fetish
	#>Not sure how you would go about passing the flag to the sex-scene generator without a huge IF list.
	#>I think you would have to do it on a one fetish per option level due o the possibility of a character having multiple fetishes.
	
	#~ we offer a choice of sex scenes here as I was using this event to test them
    option = {
        name = dag_cdo_prostitute_event.1001.male.a

		trigger = { 
			is_male = yes
			scope:particular_whore = { is_female = yes } 
		}
		dag_cdo_pay_prostitute_effect = { PROSTITUTE = scope:particular_whore }
		carn_sex_scene_request_vaginal = yes
		dag_cdo_pressured_sex_effect = {
			PLAYER = root
			TARGET = scope:particular_whore
		}
    }
	
    option = {
        name = dag_cdo_prostitute_event.1001.male.b
		trigger = { is_male = yes }
		dag_cdo_pay_prostitute_effect = { PROSTITUTE = scope:particular_whore }
		carn_sex_scene_request_oral = yes
		dag_cdo_pressured_sex_effect = {
			PLAYER = root
			TARGET = scope:particular_whore
		}
    }	
	
    option = {
        name = dag_cdo_prostitute_event.1001.male.c
		trigger = { is_male = yes }
		dag_cdo_pay_prostitute_effect = { PROSTITUTE = scope:particular_whore }
		carn_sex_scene_request_anal = yes
		dag_cdo_pressured_sex_effect = {
			PLAYER = root
			TARGET = scope:particular_whore
		}
    }	
	
	#A 'maybe we should just talk' option if player wants to back out at this stage
	option = {
        name = dag_cdo_prostitute_event.1001.d

		ai_chance = {
			base = 1
		}
		stress_impact = {
			lustful = minor_stress_impact_gain
		}		
	}
}

#####################
# Visit a brothel_whore in a brothel
# by Dagulus (based on an event by Adroit)
# 2001
#####################
#~Accepts brothel_location (optional)

dag_cdo_prostitute_event.2001 = {
	type = character_event
	title = dag_cdo_prostitute_event.2001
	desc = dag_cdo_prostitute_event.2001.desc
	theme = seduction

	left_portrait = {
        character = root
        animation = personality_rational
    }

    right_portrait = {
        character = scope:brothel_whore
        animation = flirtation
    }

    immediate = {
        #If needed, save the location of the whore for localization
        scope:brothel_whore = {
			if = {
				limit = { NOT = { exists = scope:brothel_location } }
				location = { save_scope_as = brothel_location }
			}
            add_character_flag = {
                flag = is_naked
                days = 1
            }
        }
    }

    option = {
        name = dag_cdo_prostitute_event.2001.a

		#~work on some proper localization for female players later
		trigger = { is_female = yes }
		dag_cdo_pay_prostitute_effect = { PROSTITUTE = scope:brothel_whore }
		carn_sex_scene_request_vaginal = yes
		dag_cdo_pressured_sex_effect = {
			PLAYER = root
			TARGET = scope:brothel_whore
		}
    }

	#~ we offer a choice of sex scenes here as I was using this event to test them
    option = {
        name = dag_cdo_prostitute_event.2001.male.a

		trigger = { 
			is_male = yes
			scope:brothel_whore = { is_female = yes } 
		}
		dag_cdo_pay_prostitute_effect = { PROSTITUTE = scope:brothel_whore }
		carn_sex_scene_request_vaginal = yes
		dag_cdo_pressured_sex_effect = {
			PLAYER = root
			TARGET = scope:brothel_whore
		}
    }
	
    option = {
        name = dag_cdo_prostitute_event.2001.male.b
		trigger = { is_male = yes }
		dag_cdo_pay_prostitute_effect = { PROSTITUTE = scope:brothel_whore }
		carn_sex_scene_request_oral = yes
		dag_cdo_pressured_sex_effect = {
			PLAYER = root
			TARGET = scope:brothel_whore
		}
    }	
	
    option = {
        name = dag_cdo_prostitute_event.2001.male.c
		trigger = { is_male = yes }
		dag_cdo_pay_prostitute_effect = { PROSTITUTE = scope:brothel_whore }
		carn_sex_scene_request_anal = yes
		dag_cdo_pressured_sex_effect = {
			PLAYER = root
			TARGET = scope:brothel_whore
		}
    }	
	
	#A 'maybe we should just talk' option if player wants to back out at this stage
	option = {
        name = dag_cdo_prostitute_event.2001.d

		ai_chance = {
			base = 1
		}
		stress_impact = {
			lustful = minor_stress_impact_gain
		}
	}
}

#####################
# Visit a brothel
# by Dagulus (based on an event by Adroit)
# 8001
# Tag: missing_ai_weights
#####################
#~Accepts brothel_madam (optional)
#~Accepts brothel_location (optional)

dag_cdo_prostitute_event.8001 = {
    type = character_event
    title = dag_cdo_prostitute_event.8001
    desc = dag_cdo_prostitute_event.8001.desc
	theme = dag_cdo_theme_brothel

    left_portrait = {
        character = scope:brothel_visitor
        animation = personality_rational
    }

    right_portrait = {
        character = scope:brothel_madam
        animation = personality_rational
    }

    immediate = {
		hidden_effect = {
			save_scope_as = brothel_visitor
			#~If needed, find/create brothel_madam 
			if = {
				limit = { NOT = { exists = scope:brothel_madam } }
				#~Find an available madam_character.
				random_pool_character = {
					province = root.capital_province
					limit = {
						has_trait = prostitute_3
						NOT = { has_trait = slave }
					}
					save_scope_as = brothel_madam
				}
				#~Backup generation
				if = {
					limit = { NOT = { exists = scope:brothel_madam } }
					dag_cdo_create_madam_effect = yes
					scope:created_character = { save_scope_as = brothel_madam }
				}
			}
			#~If needed, save the roots current location as the brothel_location for localization
			#~YAF timing issue prevents us using brothel_madam here
			if = {
				limit = { NOT = { exists = scope:brothel_location } }
				location = { save_scope_as = brothel_location }
			}
		}
    }

    #~show me the women
    option = {
        name = dag_cdo_prostitute_event.8001.a
		trigger = {
			is_attracted_to_women = yes
		}
        #~set a flag that says we want to see women
        set_variable = {
            name = dag_cdo_brothel_visit_see_women
            value = yes
        }
        trigger_event = dag_cdo_prostitute_event.8002
    }

    #~show me the men
    option = {
        name = dag_cdo_prostitute_event.8001.b
		trigger = {
			is_attracted_to_men = yes
		}
        #set a flag that says we want to see men
        set_variable = {
            name = dag_cdo_brothel_visit_see_women
            value = no
        }
        trigger_event = dag_cdo_prostitute_event.8002
    }

    #~actually I'll take you
    option = {
        name = dag_cdo_prostitute_event.8001.c
		remove_short_term_gold = minor_gold_value	#~Not actually working as a prostitute so we use this work around. Also makes her expensive
		dag_cdo_pressured_sex_effect = {
			PLAYER = root
			TARGET = scope:brothel_madam
		}
    }

    #~actually I'll leave
    option = {
        name = dag_cdo_prostitute_event.8001.d
    }
}

#####################
# Allow the player to choose from a list of whores based on gender
# by Dagulus (based on an event by Adroit)
# 8002
# Tag: missing_ai_weights
#####################

dag_cdo_prostitute_event.8002 = {
    type = character_event
    title = dag_cdo_prostitute_event.8002
    desc = {
        first_valid = {
            triggered_desc = {
                trigger = {
                    has_character_flag = dag_cdo_asked_to_see_more_whores
                }
                desc = dag_cdo_prostitute_event.8002.desc.start.subsequent_times
            }
            desc = dag_cdo_prostitute_event.8002.desc.start.first_time
        }
        triggered_desc = {
            trigger = {
                exists = scope:whore_one
            }
            desc = dag_cdo_prostitute_event.8002.desc.first_prostitute_description
        }
        triggered_desc = {
            trigger = {
                exists = scope:whore_two
            }
            desc = dag_cdo_prostitute_event.8002.desc.second_prostitute_description
        }
        desc = dag_cdo_prostitute_event.8002.desc.end
    }
	theme = dag_cdo_theme_brothel

    left_portrait = {
        character = scope:whore_one
        animation = flirtation_left
    }
    right_portrait = {
        character = scope:whore_two
        animation = flirtation
    }

    immediate = {
		dag_cdo_generate_whore_list = yes
		#~Generate two possible matches, add to a "viewed"
        random_in_list = {
            list = whore_list			
            save_scope_as = whore_one
        }
		random_in_list = {
            list = whore_list
			limit = {
				NOT = { this = scope:whore_one }				#~this appears to be one of those things that works but always generates an error.
			}
			save_scope_as = whore_two
		}		
	}

    option = {
        #~choose option one
        name = dag_cdo_prostitute_event.8002.a
		dag_cdo_pay_prostitute_effect = { PROSTITUTE = scope:whore_one }
		dag_cdo_pressured_sex_effect = {
			PLAYER = root
			TARGET = scope:whore_one
		}
        remove_character_flag = dag_cdo_asked_to_see_more_whores
    }
    
    option = {
        #~choose option two
        name = dag_cdo_prostitute_event.8002.b
		dag_cdo_pay_prostitute_effect = { PROSTITUTE = scope:whore_two }
		dag_cdo_pressured_sex_effect = {
			PLAYER = root
			TARGET = scope:whore_two
		}
        remove_character_flag = dag_cdo_asked_to_see_more_whores
    }

    option = {
        #~show me more options
        name = dag_cdo_prostitute_event.8002.c

        #~for localization
        if = {
            limit = {
                exists = scope:whore_one
            }
            scope:whore_one = {
                save_scope_as = previous_whore_one
            }
        }
        if = {
            limit = {
                exists = scope:whore_two
            }
            scope:whore_two = {
                save_scope_as = previous_whore_two
            }
        }

        trigger_event = dag_cdo_prostitute_event.8002

        add_character_flag = dag_cdo_asked_to_see_more_whores
    }

    option = {
        #~Leave
        name = dag_cdo_prostitute_event.8002.d
        remove_character_flag = dag_cdo_asked_to_see_more_whores
    }
}

