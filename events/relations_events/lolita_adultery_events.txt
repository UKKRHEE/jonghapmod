namespace = adultery

scripted_effect lolita_exposure_process_effect = {
	add_trait = deviant
	hidden_effect = {
		random_secret = { #Remove the deviant secret
			limit = { secret_type = secret_deviant }
			remove_secret = yes
		}
	}
	
	# 부모와 모든 좋은 관계를 삭제
	scope:sex_partner.father = {
		remove_all_good_relation = { TARGET = scope:adultery_spouse }
	}
	scope:sex_partner.mother = {
		remove_all_good_relation = { TARGET = scope:adultery_spouse }
	}
	
	# 부모 중 한명이 살아있다면 경쟁자로.
	if = {
		limit = { 
			scope:sex_partner.father = { 
				NOR = {
					is_alive = no
					this = scope:adultery_spouse
					has_relation_rival = scope:adultery_spouse
				}
			} 
		}
		set_relation_rival = scope:sex_partner.father
	}
	else_if = {
		limit = { 
			scope:sex_partner.mother = { 
				NOR = {
					is_alive = no
					this = scope:adultery_spouse
					has_relation_rival = scope:adultery_spouse
				}
			} 
		}
		set_relation_rival = scope:sex_partner.mother
	}

	scope:sex_partner = { 
		remove_all_good_relation = { TARGET = scope:adultery_spouse }
		add_opinion = {
			modifier = regret_secret_friend_opinion
			target = scope:adultery_spouse
		}
	}	
	remove_piety_level_for_shunned_or_criminal_trait_effect = { TRAIT = deviant }
}

scripted_effect lolita_exposure_stress_impact_effect = {
	stress_impact = {
		base = medium_stress_impact_gain
		shy = massive_stress_impact_gain
		chaste = massive_stress_impact_gain
		paranoid = massive_stress_impact_gain
		honest = major_stress_impact_gain
		forgiving = major_stress_impact_gain
		compassionate = major_stress_impact_gain
	}
}
###############################################
# 비밀친구가 폭로됨 #
###############################################

adultery.4101 = { 
	type = character_event
	title = adultery.4101.t
	desc = adultery.4101.desc
	
	theme = marriage
	left_portrait = scope:adultery_spouse
	right_portrait = scope:sex_partner

	immediate = {
		play_music_cue = mx_cue_combat_stinger
	}	

	option = {
		name = adultery.4101.a
		lolita_exposure_process_effect = yes
		add_piety = massive_piety_loss
		lolita_exposure_stress_impact_effect = yes
	}
}

adultery.4102 = { 
	type = character_event
	title = adultery.4102.t
	desc = adultery.4102.desc
	
	theme = marriage
	left_portrait = scope:adultery_spouse
	right_portrait = scope:sex_partner

	immediate = {
		play_music_cue = mx_cue_combat_stinger
	}	

	option = {
		name = adultery.4102.a
		lolita_exposure_process_effect = yes
		add_piety = major_piety_loss
		lolita_exposure_stress_impact_effect = yes
	}
}
