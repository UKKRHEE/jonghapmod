#연애 위신 보상 패치 /2^횟수
########################

give_balanced_court_prestige_divide_flag = {
	if = {
		limit = { has_character_flag = court_prestige_divide_2 }
		remove_character_flag = court_prestige_divide_2
		add_character_flag = court_prestige_divide_4
		}
	else_if = {
		limit = { has_character_flag = court_prestige_divide_4 }
		remove_character_flag = court_prestige_divide_4
		add_character_flag = court_prestige_divide_8
	}
	else_if = {
		limit = { has_character_flag = court_prestige_divide_8 }
		remove_character_flag = court_prestige_divide_8
		add_character_flag = court_prestige_divide_16
	}
	else_if = {
		limit = { has_character_flag = court_prestige_divide_16 }
	}
	else = {
		add_character_flag = court_prestige_divide_2
	}
}

court_success_prestige_effect = {
	if = {
		limit = { court_love_is_shunned_or_criminal_trigger = no }  #Only if it's not a taboo courtship

		#Whose tier matters?
		if = {
			limit = {
				scope:target = {
					is_ruler = no
					exists = liege
					OR = {
						is_spouse_of = this.liege
						is_close_or_extended_family_of = this.liege
					}
				}
			}
			scope:target = { liege = { save_scope_as = prestige_comparison } }
		}
		else = {
			scope:target = { save_scope_as = prestige_comparison }
		}

		#Epic
		if = {
			limit = {
				#They are at least two levels above you or empire level
				OR = {
					tier_difference = {
						target = scope:prestige_comparison
						value <= -2
					}
					scope:prestige_comparison.highest_held_title_tier = tier_empire
				}
			}
			add_prestige = {
				value = 1000 #monumental_prestige_gain
				divide = balanced_court_prestige_divide
			}
		}
		#Great
		else_if = {
			limit = {
				OR = {
					#They are one level above you or kingdom level
					tier_difference = {
						target = scope:prestige_comparison
						value = -1
					}
					scope:prestige_comparison.highest_held_title_tier = tier_kingdom
				}
			}
			add_prestige = {
				value = massive_prestige_gain
				divide = balanced_court_prestige_divide
			}
		}
		#Good
		else_if = {
			limit = {
				#They're your level or duchy level
				OR = {
					scope:prestige_comparison.highest_held_title_tier = this.highest_held_title_tier
					scope:prestige_comparison.highest_held_title_tier = tier_duchy
				}
			}		
			add_prestige = {
				value = major_prestige_value
				divide = balanced_court_prestige_divide
			}
		}
		#Okay
		else_if = {
			limit = {
				#They're at least county level
				scope:prestige_comparison.highest_held_title_tier >= tier_county
			}
			add_prestige = {
				value = medium_prestige_value
				divide = balanced_court_prestige_divide
			}
		}
		#Everything else (everyone targeting barons/unlanded)
		else = {
			add_prestige = {
				value = minor_prestige_value
				divide = balanced_court_prestige_divide
			}
		}
	}
}
