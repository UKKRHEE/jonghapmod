###################
# Demand Sex
# by Dagulus
###################

#~NB: If Carnalitas adds game rules regarding player being cucked, this interaction will need to add them.
#~Missing localizations for recipient being the player

dag_cdo_demand_sex_interaction = {
	interface_priority = -10
#	common_interaction = yes		#~Used by interaction menu (what for?)

	category = interaction_category_diplomacy
	use_diplomatic_range = yes
	ai_maybe = yes
	ai_min_reply_days = 4
	ai_max_reply_days = 9
	can_send_despite_rejection = yes
	popup_on_receive = yes
	pause_on_receive = yes

	desc = dag_cdo_demand_sex_interaction_desc

	greeting = negative
#	notification_text = 
	pre_answer_maybe_key = ANSWER_MIGHT_SUCCEED
	pre_answer_no_key = ANSWER_CANT_SUCCEED
	pre_answer_yes_key = ANSWER_WILL_SUCCEED
	pre_answer_maybe_breakdown_key = ANSWER_SUM_CHANCE

#	on_decline_summary = 

	ai_frequency = 12

	ai_targets = {
		ai_recipients = realm_characters
		chance = 0.25
	}

	ai_target_quick_trigger = {
		adult = yes
		owner_attracted = yes
	}

	ai_potential = {
		is_adult = yes
		NOR = {
			has_trait = chaste
			has_trait = celibate
			has_sexuality = asexual
		}
		#~Looks like there are additional limits on what can be put in here.
		#~any references to scope:recipient may not resolve properly.
	}

	ai_will_do = {
		base = -50	#~Low base as I am not convinced this is a winning strategy...
		ai_value_modifier = {
			ai_boldness = 0.1
			ai_energy = 0.1
			ai_compassion = -0.5
			ai_honor = -0.25
			ai_rationality = -0.25
		}
		modifier = {
			add = {
				value = dag_cdo_ai_lasciviousness_value	#~(+/- 50)
				multiply = 0.5
			}
		}
		opinion_modifier = {
			opinion_target = scope:recipient
			multiplier = -0.25
		}
		opinion_modifier = {
			trigger = { exists = scope:recipient.primary_spouse }
			opinion_target = scope:recipient.primary_spouse
			multiplier = -0.25
		}
	}

	is_valid = {
		scope:actor = {
			has_usable_hook = scope:recipient
			OR = {	#~some additioal limits to reign in the ai
				is_ai = no
				dag_cdo_wishes_to_lay_with_TARGET_trigger = { TARGET = scope:recipient }
				#~trigger here for if actor wants to cuck recipient's partner
			}			
		}
		scope:recipient = { is_ai = yes }	#~As we currently are missing localizations for this to happen to the player
	}

#	is_highlighted = { }

	is_shown = {
		NOT = { has_game_rule = carn_content_consent_always }	#~'noncon' or 'dubcon' will not be displayed.~
		NOT = { has_game_rule = carn_sex_interaction_disabled }
		NOT = { scope:recipient = scope:actor }
		scope:actor = {
			is_attracted_to_gender_of = scope:recipient
			has_usable_hook = scope:recipient
            NOR = {
                carn_relationship_allows_free_sex_trigger = { PARTNER = scope:recipient }
                scope:recipient = { carn_is_working_as_prostitute_trigger = yes }
            }
		}
		scope:recipient = {
			is_ai = yes
			carn_can_have_sex_trigger = yes
		}
	}

	is_valid_showing_failures_only = {
		scope:recipient = {
			is_diplomatically_available = yes
			carn_can_have_sex_trigger = yes
		}
	}

#	can_send = { }

	should_use_extra_icon = {
		scope:actor = { has_usable_hook = scope:recipient }
	}
	extra_icon = "gfx/interface/icons/character_interactions/hook_icon.dds"

	send_options_exclusive = no

	on_send = {
		scope:actor = {
			add_character_flag = {
				flag = flag_hostile_actions_disabled_delay
				days = 10
			}
		}
	}

	on_accept = {
		scope:actor = {
			show_as_tooltip = {
				dag_cdo_pressured_sex_effect = {
					PLAYER = scope:actor
					TARGET = scope:recipient
				}
				dag_cdo_cuckold_targets_spouse_effect = { TARGET = scope:recipient }				
			}
			use_hook = scope:recipient
			stress_impact = {
				chaste = medium_stress_impact_gain
				shy = medium_stress_impact_gain
				paranoid = medium_stress_impact_gain
				sadistic = medium_stress_impact_loss
				#~As per blackmail
				compassionate = medium_stress_impact_gain
				trusting = medium_stress_impact_gain
				honest = minor_stress_impact_gain
				just = minor_stress_impact_gain
				forgiving = minor_stress_impact_gain
			}
			hidden_effect = {
				trigger_event = {
					id = dag_cdo_demand_sex_interaction_event.0001
				}
			}
		}
	}

	on_decline = {
		scope:recipient = {
			add_opinion = {
				target = scope:actor
				modifier = dag_cdo_attempted_pressured_sex_opinion
				years = 10
			}
			if = { 
				limit = { NOT = { has_relation_rival = scope:actor } }
				progress_towards_rival_effect = {
					CHARACTER = scope:actor
					OPINION = no
				}
			}
		}
		#Letter event informing the character about the rejection.
		scope:actor = {
			trigger_event = {
				id = dag_cdo_demand_sex_interaction_event.1031
			}
		}
	}

	auto_accept = {
		scope:recipient = {
			is_obedient = scope:actor
			is_ai = yes
		}
	}

	ai_accept = {
		base = 0 										#~Should be 0 for all interactions
 		modifier = {
 			add = 50
 			desc = DAG_CDO_SPENT_A_HOOK
 		}
 		opinion_modifier = {							#~(+/- 50)
 			opinion_target = scope:actor
 			multiplier = 0.5
 		}
		ai_value_modifier = {
			ai_rationality = 0.2
			ai_boldness = -0.1
			ai_honor = -0.1
		}
		modifier = {
			add = {
				value = dag_cdo_ai_lasciviousness_value	#~(+/- 50)
				multiply = 0.5
			}
 			desc = AI_LASCIVIOUSNESS
		}
 		modifier = {
			dag_cdo_wishes_to_lay_with_TARGET_trigger = { TARGET = scope:actor }
 			add = 50
 			desc = DAG_CDO_DOES_WISH_TO_LAY_WITH_YOU
 		}
 		modifier = {
			NOT = { accepts_incest_with_trigger = { CHARACTER = scope:actor } }
 			add = -50
 			desc = DAG_CDO_DOES_NOT_WISH_TO_COMMIT_INCEST
			#~the above is intentionally duplicated (included in 'dag_cdo_wishes_to_lay_with_TARGET_trigger')
 		}
 		modifier = {
			NOT = { freely_accepts_sodomy_with_trigger = { CHARACTER = scope:actor } }
 			add = -50
 			desc = DAG_CDO_DOES_NOT_WISH_TO_COMMIT_SODOMY
			#~the above is intentionally duplicated (included in 'dag_cdo_wishes_to_lay_with_TARGET_trigger')
 		}
 		modifier = {
 			NOT = { is_spouse_of = scope:actor }
			dag_cdo_may_sleep_around_trigger = no
 			add = -25
 			desc = DAG_CDO_DOES_NOT_WISH_TO_COMMIT_ADULTERY
			#~The above includes a 'lot' of triggers, so please stop duplicating them here.
 		}
 		modifier = {
			any_spouse = { dislikes_partner_cheating_trigger = { PARTNER = scope:recipient } }
 			add = -25
 			desc = DAG_CDO_PARTNER_DISAPPROVES_OF_CHEATING
 		}	
	}

#	force_notification = yes

}
